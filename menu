--Product of ArqiTeknologies Corp.
--
--present
--
--Author: ArqiTek
--Copyrite 2250

-------Menu-------------

local w,h = term.getSize()
  Menu = {w = w, h = h, select = 1, title = "ArqiTeknologies"}

function Menu:new()
  local x = {}
  setmetatable(x, self)
  self.__index = self
  return x
end

function Menu:init(title)
  term.clear()
  term.setCursorPos(1,1)
  self.select = 1
  self.title = title
  self.list = {}
end


function Menu:printCentered(str, ypos)
  term.setCursorPos(self.w/2 - #str/2, ypos)
  term.write(str)
end

function Menu:printRight(str, ypos)
  term.setCursorPos(self.w - #str, ypos)
  term.write(str)
end

function Menu:indentLeft(str, ypos, indent)
  term.setCursorPos(indent, ypos)
  term.write(str)
end

function Menu:writeStatus(str)
  self.status = str
end

function Menu:handleSelection(str, index, indent)
  if self.select == index then
    self:indentLeft("["..str.."]", index+7, indent-1)
  else
    self:indentLeft(" "..str.."   ", index+7, indent-1)
  end
end

function Menu:drawHeader()
  term.clear()
  self:printCentered(self.title, 2)
end

function Menu:refresh()
  self:drawHeader()
  self:drawList(self.list)
end

function Menu:drawList(list)
  self.list = list
  local l = table.getn(list)
  for i=1, l do
    self:handleSelection(list[i], i, 20)
  end
  term.setCursorPos(1, self.h)
  term.write(self.status)
end

function Menu:exit()
  term.clear()
  term.setCursorPos(1,1)
end

handleSignals = function()
  rednet.open(bundle)
end


function Menu:drawMain(list)
  self:drawHeader()
  while true do
  self:drawList(list)
  local id, key = os.pullEvent("key")
  --UP = 200, DOWN = 208, ENTER = 28
  --Left 203, Right  205  x = 45
    if key == 208 then
      if self.select ~= #list
        then self.select = self.select + 1
      end
    elseif key == 200 then
      if self.select ~= 1
        then self.select = self.select-1
      end
    elseif key == 28 then
      return true
    elseif key == 45 then break
    else self:writeStatus(key.." pressed")
    end
  end
  self:exit()
end

--local list = {'Eric', 'Ian', 'Tomas'}
--m = Menu:new()
--m:init('People')
--m:drawMain(list)
--m:writeStatus("Selected option " .. m.select )
